##本章节实现上个版本的增强版，实现对多个文件进行wc操作

```
1	#!/usr/bin/env python
2	#-*- coding:utf8 -*-
3	
4	import sys
5	import os
6	from optparse import OptionParser
7	
8	def opt_fun():
9	    parser = OptionParser()
10	    """这里还是不可以出现中文，不然会有如下提示
11	                        Traceback (most recent call last):
12	                        ... ...
13	                        UnicodeDecodeError: 'ascii' codec can't decode byte 0xe7 in position 113: ordinal not in range(128)
14	    """
15	    parser.add_option("-c", "--char",
16	                        dest = "characters",
17	                        action = "store_true",
18	                        default = False,
19	                        #help = "统计字符个数"
20	                        help = "Count the characters number."
21	            )
22	
23	    parser.add_option("-w", "--word",
24	                        dest = "words",
25	                        action = "store_true",
26	                        default = False,
27	                        #help = "统计字母个数"
28	                        help = "Counter the number of words"
29	            )
30	
31	    parser.add_option("-l", "--line",
32	                        dest = "lines",
33	                        action = "store_true",
34	                        default = False,
35	                        #help = "统计行数"
36	                        help = "Counter the lines."
37	            )
38	
39	    options, args = parser.parse_args()
40	
41	    return options, args
42	
43	def get_count( data ):
44	    chars = len( data )
45	    words = len( data.split() )
46	    lines = data.count('\n')
47	
48	    return chars, words, lines
49	
50	def show(options, chars, words, lines, filename):
51	    if options.lines:
52	        print lines,
53	    if options.words:
54	        print words,
55	    if options.characters:
56	        print chars,
57	    print filename
58	
59	def main():
60	    options, args = opt_fun()
61	    if not ( options.characters or options.words or options.lines ):
62	        options.characters, options.words, options.lines = True, True, True
63	
64	    if args:
65	        file_len = len( args )
66	        total_lines, total_words, total_chars = 0, 0, 0
67	        for fn in args:
68	            if os.path.isfile( fn ):
69	                with open( fn ) as fd:
70	                    data = fd.read()
71	                chars, words, lines = get_count( data )
72	                show(options, chars, words, lines, fn)
73	                if file_len > 1:
74	                    total_lines += lines
75	                    total_words += words
76	                    total_chars += chars
77	            elif os.path.isdir( fn ):
78	                print >> sys.stdout,  "IOError: [Errno 21] Is a directory: \'%s\'" % fn
79	            else:
80	                #print >> sys.stderr, "%s: [Errno 21] Is not a file or directory: \'%s\'" % (sys.argv[0], fn)
81	                sys.stderr.write("%s: [Errno 21] Is not a file or directory: \'%s\'\n" % (sys.argv[0], fn))
82	        if file_len > 1:
83	            show(options, total_chars, total_words, total_lines, "total")
84	    else:
85	        data = sys.stdin.read()
86	        fn = ''
87	        chars, words, lines = get_count( data )
88	        show(options, chars, words, lines, fn)
89	
90	if '__main__' == __name__:
91	    main()

```
