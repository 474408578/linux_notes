1. MongoDB备份
备份指定库もngodump -h ip -d dbname -o dir //-h后面跟服务器ip，-d后面跟database名字，不加则备份所有库，-o后指定备份到哪里，它是一个目录
备份所有库もngodump -h ip -o dir
备份指定集合もngodump -d mydb -c testc -o /tmp/testc //-c指定集合名字 
导出集合为json文件もngoexport -d mydb -c testc -o /tmp/testc.json // -o后面跟的是一个文件名字

2. MongoDB恢复
恢复所有库もngorestore --drop dir/ //其中dir是备份所有库的目录名字，其中--drop可选，意思是当恢复之前先把之前的数据删除，不建议使用
恢复指定库もngorestore -d mydb dir/  //-d跟要恢复的库名字，dir就是该库备份时所在的目录
恢复集合もngorestore -d mydb -c testc dir/mydb/testc.bson // -c后面跟要恢复的集合名字，dir是备份mydb库时生成文件所在路径，这里是一个bson文件的路径
导入集合もngoimport -d mydb -c testc --file /tmp/testc.json

注意：恢复的时候要注意路径, 注意看下两条命令的差别
[root@kvm ~]# mongorestore -d mydb /tmp/mongodb_bak_all/
2016-04-26T01:15:39.901+0800building a list of collections to restore from /tmp/mongodb_bak_all/ dir
2016-04-26T01:15:39.901+0800buildingdon't know what to do with subdirectory "/tmp/mongodb_bak_all/admin", skipping...
2016-04-26T01:15:39.901+0800buildingdondon't know what to do with subdirectory "/tmp/mongodb_bak_all/mydb", skipping...
2016-04-26T01:15:39.901+0800buildingdondondon't know what to do with subdirectory "/tmp/mongodb_bak_all/mydb2", skipping...
2016-04-26T01:15:39.901+0800buildingdondondondone
[root@kvm ~]# mongorestore -d mydb /tmp/mongodb_bak_all/mydb
2016-04-26T01:16:16.865+0800buildingdondondondonebuilding a list of collections to restore from /tmp/mongodb_bak_all/mydb dir
2016-04-26T01:16:16.865+0800buildingdondondondonebuildingreading metadata file from /tmp/mongodb_bak_all/mydb/testc.metadata.json
2016-04-26T01:16:16.866+0800buildingdondondondonebuildingreadingrestoring mydb.testc from file /tmp/mongodb_bak_all/mydb/testc.bson
2016-04-26T01:16:17.132+0800buildingdondondondonebuildingreadingrestoringrestoring indexes for collection mydb.testc from metadata
2016-04-26T01:16:17.132+0800buildingdondondondonebuildingreadingrestoringrestoringfinished restoring mydb.testc (3 documents)
2016-04-26T01:16:17.132+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddone

## 针对所有库备份的时候，会出现这个错误，说明这个库是已经存在的了。如果不放心可以对现在的库再进行一次备份，然后使用--drop选项就没有问题了
2016-04-26T01:18:09.448+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerror: E11000 duplicate key error index: mydb.testc.$_id_ dup key: { : ObjectId('571e4deced61b09acfa462d9') }

[root@kvm ~]# mongorestore  --drop /tmp/mongodb_bak_all/
2016-04-26T01:20:00.642+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuilding a list of dbs and collections to restore from /tmp/mongodb_bak_all/ dir
2016-04-26T01:20:00.651+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreading metadata file from /tmp/mongodb_bak_all/mydb/testc.metadata.json
2016-04-26T01:20:00.651+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoring mydb.testc from file /tmp/mongodb_bak_all/mydb/testc.bson
2016-04-26T01:20:00.655+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreading metadata file from /tmp/mongodb_bak_all/mydb2/testc2.metadata.json
2016-04-26T01:20:00.655+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoring mydb2.testc2 from file /tmp/mongodb_bak_all/mydb2/testc2.bson
2016-04-26T01:20:00.667+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoring indexes for collection mydb2.testc2 from metadata
2016-04-26T01:20:00.668+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoring indexes for collection mydb.testc from metadata
2016-04-26T01:20:00.669+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinished restoring mydb.testc (3 documents)
2016-04-26T01:20:00.670+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinished restoring mydb2.testc2 (0 documents)
2016-04-26T01:20:00.675+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreading metadata file from /tmp/mongodb_bak_all/admin/changfeng.metadata.json
2016-04-26T01:20:00.675+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoring admin.changfeng from file /tmp/mongodb_bak_all/admin/changfeng.bson
2016-04-26T01:20:00.676+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreading metadata file from /tmp/mongodb_bak_all/admin/mycolloction.metadata.json
2016-04-26T01:20:00.678+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoring indexes for collection admin.changfeng from metadata
2016-04-26T01:20:00.679+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinished restoring admin.changfeng (0 documents)
2016-04-26T01:20:00.679+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoring admin.mycolloction from file /tmp/mongodb_bak_all/admin/mycolloction.bson
2016-04-26T01:20:00.692+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoring indexes for collection admin.mycolloction from metadata
2016-04-26T01:20:00.693+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinished restoring admin.mycolloction (0 documents)
2016-04-26T01:20:00.693+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoring users from /tmp/mongodb_bak_all/admin/system.users.bson
2016-04-26T01:20:00.693+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusers file '/tmp/mongodb_bak_all/admin/system.users.bson' is empty; skipping users restoration
2016-04-26T01:20:00.693+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdone
[root@kvm ~]# echo $?
0

ot@kvm ~]# mongoimport -d mydb -c testc --drop --file /tmp/mongodb_bak_all/mydb/testc.bson 
2016-04-26T01:24:58.272+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnected to: localhost
2016-04-26T01:24:58.277+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddropping: mydb.testc
2016-04-26T01:24:58.278+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailed: error processing document #1: invalid character '?' looking for beginning of value
2016-04-26T01:24:58.278+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailedimported 0 documents
[root@kvm ~]# mongoimport -d mydb -c testc  --file /tmp/mongodb_bak_all/mydb/testc.bson 
2016-04-26T01:25:43.605+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailedimportedconnected to: localhost
2016-04-26T01:25:43.605+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailedimportedconnectedFailed: error processing document #1: invalid character '?' looking for beginning of value
2016-04-26T01:25:43.605+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailedimportedconnectedFailedimported 0 documents
[root@kvm ~]# mongoimport -d mydb -c testc  --file /tmp/mongodb_bak_all/mydb/testc.metadata.json 
2016-04-26T01:25:51.770+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailedimportedconnectedFailedimportedconnected to: localhost
2016-04-26T01:25:51.771+0800buildingdondondondonebuildingreadingrestoringrestoringfinisheddoneerrorbuildingreadingrestoringreadingrestoringrestoringrestoringfinishedfinishedreadingrestoringreadingrestoringfinishedrestoringrestoringfinishedrestoringusersdoneconnecteddroppingFailedimportedconnectedFailedimportedconnectedimported 1 document
[root@kvm ~]# 
